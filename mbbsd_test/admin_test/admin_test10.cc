#include "admin_test.h"

TEST_F(AdminTest, MModBoard) {
  char buf[TEST_BUFFER_SIZE] = {};

  bzero(buf, TEST_BUFFER_SIZE);
  sprintf(buf, "q\r\n");
  put_vin((unsigned char *)buf, strlen(buf));

  char bname[TEST_BUFFER_SIZE] = {};
  sprintf(bname, "WhoAmI");
  int ret = m_mod_board(bname);
  EXPECT_EQ(ret, 0);

  refresh();
  log_oflush_buf();

  unsigned char expected[] = "\x1B\x5B\x31\x3B\x31\x48" //\x1b[1;1H
      "\xB3\x5D\xA9\x77\x20\x5B\x57\x68\x6F\x41\x6D\x49\x5D\x20" //設定 [WhoAmI]
      "\xAC\xDD\xAA\x4F\xA4\xA7\x28\xBE\x5C" //看板之(月
      "\xC5\xAA\x29\xC5\x76\xAD\xAD\xA1\x47" //讀)權限：
      "\x1B\x5B\x31\x31\x3B\x31\x48" //\x1b[11;1H
      "\x28\x45\x29\xB3\x5D\xA9\x77\x20\x28\x56\x29\xB5\x6F\xA4\xE5" //(E)設定 (V)發文
      "\xBC\xFA\xC0\x79\x20\x5B\x51\x5D\xA8\xFA" //獎勵 [Q]取
      "\xAE\xF8\x3F\x20" //消?
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x20\x20\x20"
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x31\x48" //\x1b[m\x1b[24;1H
      "\xAC\xDD\xAA\x4F\xA6\x57\xBA\xD9\xA1\x47\x57\x68\x6F\x41\x6D\x49\x20" //看板名稱：WhoAmI
      "\x1B\x5B\x4B\x1B\x5B\x31\x31\x3B\x33\x30\x48\x0D" //\x1b[K\x1b[11;30H
      "\x28\x45\x29\xB3\x5D\xA9\x77\x20\x28\x56\x29\xB5\x6F\xA4\xE5\xBC\xFA\xC0\x79" //(E)設定 (V)發文獎勵
      "\x20\x5B\x51\x5D\xA8\xFA\xAE\xF8\x3F\x20" // [Q]取消?
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x71\x20\x20" //q
      "\x1B\x5B\x6D\x1B\x5B\x31\x31\x3B\x33\x31\x48\x0A\x0D" //\x1b[m\x1b[11;31H
      "\0";

  EXPECT_STREQ((char *)OFLUSH_BUF, (char *)expected);
}
