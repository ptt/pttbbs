#include "admin_test.h"

TEST_F(AdminTest, SearchUserBybakpwd) {
  char buf[TEST_BUFFER_SIZE] = {};

  bzero(buf, TEST_BUFFER_SIZE);
  sprintf(buf, "1\r\nSYSOP10\r\ns\r\n");
  put_vin((unsigned char *)buf, strlen(buf));

  int ret = search_user_bybakpwd();
  EXPECT_EQ(ret, 0);

  refresh();
  log_oflush_buf();

  unsigned char expected[] = "\x1B\x5B\x48\x1B\x5B\x4A\x0A"
      "\x20\xBD\xD0\xBF\xE9\xA4\x4A\xA7\x41\xAD\x6E\xA5\xCE" // 請輸入你要用
      "\xA8\xD3\xB4\x4D\xA7\xE4\xB3\xC6\xA5\xF7" //來尋找備份
      "\xAA\xBA\xC0\xC9\xAE\xD7\x20\xA9\xCE" //的檔案 或
      "\xAB\xF6\x20\x27\x71\x27\x20\xC2\xF7\xB6\x7D\x0A\x0D" //按 'q' 離開
      "\x20\x5B" // [
      "\x1B\x5B\x31\x3B\x33\x31\x6D" //\x1b[1;31m
      "\x31" //1
      "\x1B\x5B\x6D"
      "\x5D\xA4\x40\xA4\xD1\xAB\x65\x2C\x20\x5B" //]一天前, [
      "\x1B\x5B\x31\x3B\x33\x31\x6D" //\x1b[1;31m
      "\x32" //2
      "\x1B\x5B\x6D"
      "\x5D\xA8\xE2\xA4\xD1\xAB\x65\x2C\x20\x5B" //]兩天前, [
      "\x1B\x5B\x31\x3B\x33\x31\x6D" //\x1b[1;31m
      "\x33" //3
      "\x1B\x5B\x6D"
      "\x5D\xA4\x54\xA4\xD1\xAB\x65\x0A\x0D" //]三天前
      "\x20\x5B" // [
      "\x1B\x5B\x31\x3B\x33\x31\x6D"
      "\x34" //4
      "\x1B\x5B\x6D"
      "\x5D\xA5\x7C\xA4\xD1\xAB\x65\x2C\x20\x5B" //]四天前, [
      "\x1B\x5B\x31\x3B\x33\x31\x6D"
      "\x35" //5
      "\x1B\x5B\x6D"
      "\x5D\xA4\xAD\xA4\xD1\xAB\x65\x2C\x20\x5B" //]五天前, [
      "\x1B\x5B\x31\x3B\x33\x31\x6D"
      "\x36"
      "\x1B\x5B\x6D"
      "\x5D\xA4\xBB\xA4\xD1\xAB\x65\x0A\x0D" //]六天前
      "\x20\x5B\x37\x5D\xB3\xC6\xA5\xF7\xAA\xBA\x0A\x0D" // [7]備份的
      "\x20\xBF\xEF\xBE\xDC\x20\x3D\x3E\x20" // 選擇 =>
      "\x1B\x5B\x32\x34\x3B\x31\x48" //\x1b[24;1H
      "\x1B\x5B\x31\x3B\x33\x36\x3B\x34\x34\x6D" //\x1b[1;36;44m
      "\x20\xA1\xBB\x20\xC0\xC9\xAE\xD7\xA4\xA3\xA6\x73" // ◆ 檔案不存
      "\xA6\x62\x20\x20\x20\x20\x20\x20\x20\x20" //在
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
      "\x20"
      "\x1B\x5B\x31\x3B\x33\x33\x3B\x34\x36\x6D"
      "\x20\x5B\xAB\xF6\xA5\xF4\xB7\x4E" // [按任意
      "\xC1\xE4\xC4\x7E\xC4\xF2\x5D\x20" //鍵繼續]
      "\x1B\x5B\x6D\x0D\x1B\x5B\x4B" //\x1b[m\n\x1b[H
      "\0";

  EXPECT_STREQ((char *)OFLUSH_BUF, (char *)expected);

}
