#include "admin_test.h"

TEST_F(AdminTest, MLoginmsg) {
  char buf[TEST_BUFFER_SIZE] = {};

  bzero(buf, TEST_BUFFER_SIZE);
  sprintf(buf, "y\r\ntestwaterball\r\n");
  put_vin((unsigned char *)buf, strlen(buf));

  int ret = m_loginmsg();
  EXPECT_EQ(ret, 0);

  refresh();

  unsigned char expected[] = "\x1B\x5B\x32\x33\x3B\x31\x48"
      "\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A\xA5\xBB\xAF\xB8" //進站水球:本站
      "\xAC\xA1\xB0\xCA\x2C\xA4\xA3\xA4\x7A\xC2\x5A\xA8\xCF" //活動,不干擾使
      "\xA5\xCE\xAA\xCC\xAC\xB0\xAD\xAD\x2C\xB3\x5D\xA9\x77" //用者為限,設定
      "\xAA\xCC\xC2\xF7\xAF\xB8\xA6\xDB\xB0\xCA\xA8\xFA\xAE\xF8" //者離站自動取消
      "\x2C\xBD\x54\xA9\x77\xAD\x6E\xB3\x5D\x3F" //,確定要設?
      "\x28\x79\x2F\x4E\x29" //(y/N)
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x20\x20\x20"

      "\x1B\x5B\x6D\x0A\x0D" //\x1b[m
      "\x1B\x5B\x4B\x1B\x5B\x32\x33\x3B\x36\x39\x48\x0D" //\x1b[K\x1b[23;69H
      "\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //進站水球:
      "\xA5\xBB\xAF\xB8\xAC\xA1\xB0\xCA\x2C" //本站活動,
      "\xA4\xA3\xA4\x7A\xC2\x5A\xA8\xCF\xA5\xCE" //不干擾使用
      "\xAA\xCC\xAC\xB0\xAD\xAD\x2C\xB3\x5D\xA9\x77" //者為限,設定
      "\xAA\xCC\xC2\xF7\xAF\xB8\xA6\xDB\xB0\xCA" //者離站自動
      "\xA8\xFA\xAE\xF8\x2C\xBD\x54\xA9\x77" //取消,確定
      "\xAD\x6E\xB3\x5D\x3F\x28\x79\x2F\x4E\x29" //要設?(y/N)
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x79\x20\x20" //y
      "\x1B\x5B\x6D\x1B\x5B\x32\x33\x3B\x37\x30\x48\x0A\x0D" //\x1b[m\x1b[23;70H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8" //設定進站
      "\xA4\xF4\xB2\x79\x3A" //水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20" //lltes
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x31\x34\x48\x0D" //\x1b[m\x1b[24;14H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //t
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x31\x35\x48\x0D" //\x1b[m\x1b[24;15H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x65\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //te
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x31\x36\x48\x0D" //\x1b[m\x1b[24;16H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x65\x73\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //tes
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20" //
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x31\x37\x48\x0D" //\x1b[m\x1b[24;17H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x65\x73\x74\x20\x20\x20\x20\x20\x20\x20\x20" //test
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20" //tes
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x31\x38\x48\x0D" //\x1b[m\x1b[24;18H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x65\x73\x74\x77\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //testw
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x31\x39\x48\x0D" //\x1b[m\x1b[24;19H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x65\x73\x74\x77\x61\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //testwa
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x30\x48\x0D" //\x1b[m\x1b[24;20H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x65\x73\x74\x77\x61\x74\x20\x20\x20\x20" //testwat
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20" //ltes
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x31\x48\x0D" //\x1b[m\x1b[24;21H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A" //設定進站水球:
      "\x1B\x5B\x30\x3B\x37\x6D" //\x1b[0;7m
      "\x74\x65\x73\x74\x77\x61\x74\x65\x20\x20\x20\x20\x20\x20" //testwate
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20"
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x32\x48\x0D" //\x1b[m\x1b[24;22H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A"
      "\x1B\x5B\x30\x3B\x37\x6D"
      "\x74\x65\x73\x74\x77\x61\x74\x65\x72\x20" //testwater
      "\x20\x20\x20\x20\x20\x20\x20"
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x33\x48\x0D" //\x1b[m\x1b[24;23H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A"
      "\x1B\x5B\x30\x3B\x37\x6D"
      "\x74\x65\x73\x74\x77\x61\x74\x65\x72\x62" //testwaterb
      "\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20"
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x34\x48\x0D" //\x1b[m\x1b[24;24H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A"
      "\x1B\x5B\x30\x3B\x37\x6D"
      "\x74\x65\x73\x74\x77\x61\x74\x65\x72\x62" //testwaterb
      "\x61\x20\x20\x20\x20\x20\x20" //a
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20"
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x35\x48\x0D" //\x1b[m\x1b[24;25H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A"
      "\x1B\x5B\x30\x3B\x37\x6D"
      "\x74\x65\x73\x74\x77\x61\x74\x65\x72\x62" //testwaterb
      "\x61\x6C\x20\x20\x20\x20\x20" //al
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20"

      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x36\x48\x0D" //\x1b[m\x1b[24;26H
      "\xB3\x5D\xA9\x77\xB6\x69\xAF\xB8\xA4\xF4\xB2\x79\x3A"
      "\x1B\x5B\x30\x3B\x37\x6D"
      "\x74\x65\x73\x74\x77\x61\x74\x65\x72\x62" //testwaterb
      "\x61\x6C\x6C\x20\x20\x20\x20" //all
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" //
      "\x20\x20\x20\x20\x20\x20\x20\x20\x20"
      "\x1B\x5B\x6D\x1B\x5B\x32\x34\x3B\x32\x37\x48\x0D" //\x1b[m\x1b[24;27H
      "\0";
  EXPECT_STREQ((char *)OFLUSH_BUF, (char *)expected);
}
