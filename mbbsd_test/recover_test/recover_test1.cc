#include "recover_test.h"

TEST_F(RecoverTest, Run) {
  // load SYSOP2
  initcuser("SYSOP2");

  char buf[8192] = {};
  // load SYSOP2

  sprintf(buf, "SYSOP10\r\ndevptt12346@gmail.com\r\nqwertyuipasdfghjkzxcvbnmoQWERT\r\n123456\r\n123456\r\n ");
  put_vin((unsigned char *)buf, strlen(buf));

  refresh();
  reset_oflush_buf();

  ::AccountRecovery ac;
  ac.Run();

  refresh();

  unsigned char expected[] = ""
      "\x1B[H\x1B[J"
      "\x1B[1;37;46m\xA1i \xA8\xFA\xA6^\xB1" "b\xB8\xB9 \xA1j" //【 取回帳號 】
      "\x1B[m\x1B[3;1H\xA5\xD8\xAB" "e\xB6\xC8\xAF\xE0\xA8\xFA\xA6^\xA8\xCF\xA5\xCE Email \xB5\xF9\xA5U\xA4\xA7\xB1" "b\xB8\xB9\xA1" "C" //目前僅能取回使用 Email 註冊之帳號。
      "\x1B[5;1H\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G" //欲取回帳號ID：
      "\x1B[0;7m             \x1B[m"
      "\x1B[5;15H\r\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G"
      "\x1B[0;7mS            \x1B[m"
      "\x1B[5;16H\r\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G"
      "\x1B[0;7mSY           \x1B[m"
      "\x1B[5;17H\r\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G"
      "\x1B[0;7mSYS          \x1B[m"
      "\x1B[5;18H\r\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G"
      "\x1B[0;7mSYSO         \x1B[m"
      "\x1B[5;19H\r\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G"
      "\x1B[0;7mSYSOP        \x1B[m"
      "\x1B[5;20H\r\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G"
      "\x1B[0;7mSYSOP1       \x1B[m"
      "\x1B[5;21H\r\xB1\xFD\xA8\xFA\xA6^\xB1" "b\xB8\xB9ID\xA1G"
      "\x1B[0;7mSYSOP10      \x1B[m\x1B[5;22H\n\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G" //認證信箱：
      "\x1B[0;7m                                                  \x1B[m\x1B[6;11H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7md                                                 \x1B[m\x1B[6;12H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mde                                                \x1B[m\x1B[6;13H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdev                                               \x1B[m\x1B[6;14H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevp                                              \x1B[m\x1B[6;15H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevpt                                             \x1B[m\x1B[6;16H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt                                            \x1B[m\x1B[6;17H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt1                                           \x1B[m\x1B[6;18H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12                                          \x1B[m\x1B[6;19H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt123                                         \x1B[m\x1B[6;20H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt1234                                        \x1B[m\x1B[6;21H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346                                       \x1B[m\x1B[6;22H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@                                      \x1B[m\x1B[6;23H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@g                                     \x1B[m\x1B[6;24H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gm                                    \x1B[m\x1B[6;25H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gma                                   \x1B[m\x1B[6;26H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gmai                                  \x1B[m\x1B[6;27H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gmail                                 \x1B[m\x1B[6;28H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gmail.                                \x1B[m\x1B[6;29H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gmail.c                               \x1B[m\x1B[6;30H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gmail.co                              \x1B[m\x1B[6;31H\r"
      "\xBB{\xC3\xD2\xABH\xBD" "c\xA1G"
      "\x1B[0;7mdevptt12346@gmail.com                             \x1B[m\x1B[6;32H"
      "\x1B[8;1H\xA8t\xB2\xCE\xB3" "B\xB2z\xA4\xA4...\r" //系統處理中...
      "\xADY\xB1z\xBF\xE9\xA4J\xAA\xBA\xB8\xEA\xAE\xC6\xA5\xBF\xBDT\xA1" "A\xA8t\xB2\xCE\xA4w\xB1N\xBB{\xC3\xD2\xBDX\xB1H\xB0" "e\xA6\xDC\xB1z\xAA\xBA\xABH\xBD" "c\xA1" "C\n\r" //若您輸入的資料正確，系統已將認證碼寄送至您的信箱。
      "\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G" //請收信後輸入認證碼：
      "\x1B[0;7m                               \x1B[m"
      "\x1B[9;21H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mq                              \x1B[m"
      "\x1B[9;22H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqw                             \x1B[m"
      "\x1B[9;23H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwe                            \x1B[m"
      "\x1B[9;24H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwer                           \x1B[m"
      "\x1B[9;25H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwert                          \x1B[m"
      "\x1B[9;26H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwerty                         \x1B[m"
      "\x1B[9;27H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyu                        \x1B[m"
      "\x1B[9;28H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyui                       \x1B[m"
      "\x1B[9;29H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuip                      \x1B[m"
      "\x1B[9;30H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipa                     \x1B[m"
      "\x1B[9;31H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipas                    \x1B[m"
      "\x1B[9;32H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasd                   \x1B[m"
      "\x1B[9;33H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdf                  \x1B[m"
      "\x1B[9;34H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfg                 \x1B[m"
      "\x1B[9;35H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfgh                \x1B[m"
      "\x1B[9;36H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghj               \x1B[m"
      "\x1B[9;37H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjk              \x1B[m"
      "\x1B[9;38H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkz             \x1B[m"
      "\x1B[9;39H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzx            \x1B[m"
      "\x1B[9;40H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxc           \x1B[m"
      "\x1B[9;41H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcv          \x1B[m"
      "\x1B[9;42H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvb         \x1B[m"
      "\x1B[9;43H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbn        \x1B[m"
      "\x1B[9;44H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbnm       \x1B[m"
      "\x1B[9;45H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbnmo      \x1B[m"
      "\x1B[9;46H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbnmoQ     \x1B[m"
      "\x1B[9;47H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbnmoQW    \x1B[m"
      "\x1B[9;48H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbnmoQWE   \x1B[m"
      "\x1B[9;49H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbnmoQWER  \x1B[m"
      "\x1B[9;50H\r\xBD\xD0\xA6\xAC\xABH\xAB\xE1\xBF\xE9\xA4J\xBB{\xC3\xD2\xBDX\xA1G"
      "\x1B[0;7mqwertyuipasdfghjkzxcvbnmoQWERT \x1B[m"
      "\x1B[9;51H\x1B[11;1H\xBD\xD0\xB3]\xA9w\xB7s\xB1K\xBDX\xA1G" //請設定新密碼：
      "\x1B[0;7m         \x1B[m\x1B[11;15H\r"
      "\xBD\xD0\xB3]\xA9w\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m*        \x1B[m\x1B[11;16H\r"
      "\xBD\xD0\xB3]\xA9w\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m**       \x1B[m\x1B[11;17H\r"
      "\xBD\xD0\xB3]\xA9w\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m***      \x1B[m\x1B[11;18H\r"
      "\xBD\xD0\xB3]\xA9w\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m****     \x1B[m\x1B[11;19H\r"
      "\xBD\xD0\xB3]\xA9w\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m*****    \x1B[m\x1B[11;20H\r"
      "\xBD\xD0\xB3]\xA9w\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m******   \x1B[m\x1B[11;21H\n\r"
      "\xBD\xD0\xAA`\xB7N\xB3]\xA9w\xB1K\xBDX\xA5u\xA6\xB3\xAB" "e\xA4K\xAD\xD3\xA6r\xA4\xB8\xA6\xB3\xAE\xC4\xA1" "A\xB6W\xB9L\xAA\xBA\xB1N\xA6\xDB\xB0\xCA\xA9\xBF\xB2\xA4\xA1" "C\n\r" //請注意設定密碼只有前八個字元有效，超過的將自動忽略。
      "\xBD\xD0\xC0\xCB\xAC" "d\xB7s\xB1K\xBDX\xA1G" //請檢查新密碼：
      "\x1B[0;7m         \x1B[m\x1B[13;15H\r"
      "\xBD\xD0\xC0\xCB\xAC" "d\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m*        \x1B[m\x1B[13;16H\r"
      "\xBD\xD0\xC0\xCB\xAC" "d\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m**       \x1B[m\x1B[13;17H\r"
      "\xBD\xD0\xC0\xCB\xAC" "d\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m***      \x1B[m\x1B[13;18H\r"
      "\xBD\xD0\xC0\xCB\xAC" "d\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m****     \x1B[m\x1B[13;19H\r"
      "\xBD\xD0\xC0\xCB\xAC" "d\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m*****    \x1B[m\x1B[13;20H\r"
      "\xBD\xD0\xC0\xCB\xAC" "d\xB7s\xB1K\xBDX\xA1G"
      "\x1B[0;7m******   \x1B[m\x1B[13;21H\x1B[24;1H\x1B[1;36;44m"
      " \xA1\xBB \xB1K\xBDX\xAD\xAB\xB3]\xA7\xB9\xA6\xA8\xA1" "A\xBD\xD0\xA5H\xB7s\xB1K\xBDX\xB5n\xA4J\xA1" "C                             " // ◆ 密碼重設完成，請以新密碼登入。
      "\x1B[1;33;46m [\xAB\xF6\xA5\xF4\xB7N\xC1\xE4\xC4~\xC4\xF2] \x1B[m\r\x1B[K" // [按任意鍵繼續]
      "\0";

  EXPECT_STREQ((char *)OFLUSH_BUF, (char *)expected);
}
